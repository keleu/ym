<div class="tableform">
  <form id="sysshop_form" name="sysshop_form" action="?app=sysshop&ctl=admin_shop&act=saveSelfShop"  method="post">
    <input type="hidden" name="shop[shop_id]" value="<{$shop.shop_id}>">
    <div class="division">
      <table width="100%" cellspacing="0" cellpadding="0" border="0">
        <tbody>
          <tr>
            <th><em class="red">店铺信息</em></th>
          </tr>
          <tr>
            <th><{t}>店铺名称：<{/t}></th>
            <td>
              <{if $shop.shop_name}>
                <{$shop.shop_name}>
                <{input type="hidden"  name="shop[shop_name]" value=$shop.shop_name}>
              <{else}>
                 <{input type="text" vtype="required"  name="shop[shop_name]" value=$shop.shop_name}>
              <{/if}>
            </td>
          </tr>
          <tr>
            <th><{t}>店铺描述：<{/t}></th>
            <td><{input type="textarea" vtype="required"  name="shop[shop_descript]" value=$shop.shop_descript maxlength="200"}> </td>
          </tr>
          <tr>
            <th><{t}>店铺Logo：<{/t}></th>
            <td><{input type="image" vtype="required"  name="shop[shop_logo]" value=$shop.shop_logo}> </td>
          </tr>
          <tr>
            <th><{t}>店主姓名：<{/t}></th>
            <td><{input type="text" vtype="required"  name="shop[shopuser_name]" value=$shop.shopuser_name}> </td>
          </tr>
          <tr>
            <th><{t}>店主身份证号：<{/t}></th>
            <td><{input type="text" vtype="required"  name="shop[shopuser_identity]" value=$shop.shopuser_identity}> </td>
          </tr>
          <tr>
            <th><{t}>店主身份证电子版：<{/t}></th>
            <td><{input type="image" vtype="required" name="shop[shopuser_identity_img]" value=$shop.shopuser_identity_img width=100 height=100}> </td>
          </tr>
          <tr>
            <th><{t}>所在地区：<{/t}></th>
            <td>
            <!-- <{input type="text" vtype="required"  name="shop[shop_area]" value=$shop.shop_area}>  -->
            <select name="shop[company_area_first]" id ="shop_info_first" onchange="getChild()">
              <option value='no'>-请选择-</option>
              <{foreach from=$areaMap item=itemarea}>
              <option value="<{$itemarea.value}>" <{if $itemarea.value==$shop.company_area_first}>selected="selected"<{/if}>><{$itemarea.value}></option>
              <{/foreach}>
            </select>
            <select name="shop[company_area_second]" id="shop_info_second" onchange="getThird()" class="hide"></select>
            <select name="shop[company_area_third]" id="shop_info_third" class="hide"></select>
            </td>
          </tr>
          <tr>
            <th><{t}>详细地址：<{/t}></th>
            <td><{input type="text" vtype="required"  name="shop[shop_addr]" value=$shop.shop_addr}> </td>
          </tr>
          <tr>
            <th><{t}>手机号码：<{/t}></th>
            <td><{input type="text" vtype="required"  name="shop[mobile]" value=$shop.mobile}> </td>
          </tr>
          <tr>
            <th><{t}>邮箱：<{/t}></th>
            <td><{input type="text" vtype="required"  name="shop[email]" value=$shop.email}> </td>
          </tr>
        </tbody>
      </table>
    </div>

    <table cellspacing="0" cellpadding="0" class="table-action">
      <tbody>
        <tr valign="middle">
          <td>
            <{assign var="___c"  value='确定退出?'|t:'sysshop'}>

            <{button label="保存并关闭窗口"|t:'sysshop' class="btn-primary" type="button"  onclick="submitForm(event,2)"}>

            <{button label="关  闭"|t:'content' class="btn-secondary" type="button" isclosedialogbtn="1"}>
          </td>
        </tr>
      </tbody>
    </table>
  </form>
</div>

<script>
var areaMapJson = '<{$areaMap|json_encode}>';
var areaMap = JSON.decode(areaMapJson);
var company_area_second = '<{$shop.company_area_second}>';
var company_area_third = '<{$shop.company_area_third}>';
var bz=0;
  if(company_area_second){
    bz=1;
    getChild();
    bz=0;
  }
  if(company_area_third){
    bz=1;
    getThird();
    bz=0;
  }

  /**
  * ps : 获取二级地区
  * Time：2016/04/25 17:22:03
  * @author jianghui
  */
  function getChild(){
    var shop_info_first = document.getElementById("shop_info_first").value;
    var first = areaMap[shop_info_first];
    var secondarea = document.getElementById("shop_info_second");
    var thirdarea = document.getElementById("shop_info_third");
    secondarea.options.length=0;
    thirdarea.options.length=0;
    thirdarea.className = 'hide';
    if(first){
      var second = first['children'];
      secondarea.className = '';
      secondarea.options.add(new Option("-请选择-",'no'));
      var i=0;j=-1;
      for(var k in second){
          secondarea.options.add(new Option(k,k));
          i++;
          if(k==company_area_second){
            j=i;
          }
        }
        if(bz==1){
          secondarea.options[j].selected = "selected";
        }
    }else{
      secondarea.className = 'hide';
    }
  }

  /**
  * ps ：获取三级地区
  * Time：2016/04/25 17:23:45
  * @author jianghui
  */
  function getThird(){
    var shop_info_first = document.getElementById("shop_info_first").value;
    var shop_info_second = document.getElementById("shop_info_second").value;
    var second = areaMap[shop_info_first]['children'][shop_info_second];
    var secondthird = document.getElementById("shop_info_third");
    secondthird.options.length=0;
    if(second){
      var third = second['children'];
      if(third.length!=0){
        secondthird.className = '';
        secondthird.options.add(new Option("-请选择-",'no'));
        var i=0;j=-1;
        for(var k in third){
          secondthird.options.add(new Option(k,k));
          i++;
          if(k==company_area_third){
            j=i;
          }
        }
        if(bz==1){
          secondthird.options[j].selected = "selected";
        }
      }else{
        secondthird.className = 'hide';
      }
    }else{
      secondthird.className = 'hide';
    }
  }

  var submitForm = function (event,sign){
    var _form=$('sysshop_form');
    switch (sign){
      case 1:
        var target={
          onComplete:function(){
                       location.reload();
                     }};
        break;
      case 2:
        var target={
          onComplete:function(rs){
                       if(rs&&!!JSON.decode(rs).success){
                           window.finderGroup['<{$env.get.finder_id}>'].refresh();
                           _form.getParent('.dialog').retrieve('instance').close();
                       }
                     }};
        break;
    }
    _form.store('target',target);
    if(confirm('是否保存?')) {
      _form.fireEvent('submit',new Event(event));
    }
  };

</script>
